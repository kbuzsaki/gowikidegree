<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/static/bootstrap.min.css">
        <script src="/static/jquery.min.js"></script>
    </head>
    <body>
        <div class="container">
            <h1>Six Degrees of Wikipedia</h1>
            <div class="panel panel-default">
                <div class="panel-heading">
                    Find Shortest Path
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label for="start-link">Start Link</label>
                        <input type="text" id="start-link" class="form-control"
                               placeholder="e.g. 'Bubble_gum' or 'https://en.wikipedia.org/wiki/Bubble_gum'" />
                    </div>
                    <div class="form-group">
                        <label for="start-link">End Link</label>
                        <input type="text" id="end-link" class="form-control"
                               placeholder="e.g. 'Adolf_Hitler' or 'https://en.wikipedia.org/wiki/Adolf_Hitler'" />
                    </div>
                    <div class="row">
                        <div class="col-sm-4 col-xs-2">
                        </div>
                        <div class="col-sm-4 col-xs-8">
                            <div class="form-group">
                                <input type="submit" id="submit" class="form-control" value="Find Shortest Path" />
                            </div>
                        </div>
                        <div class="col-sm-4 col-xs-2">
                        </div>
                    </div>
                </div>
            </div>
            <div id="results-panel" class="panel panel-info">
                <div class="panel-heading">
                    Results
                </div>
                <div class="panel-body">
                </div>
            </div>
            <div id="error-panel" class="panel panel-danger">
                <div class="panel-heading">
                    Error
                </div>
                <div class="panel-body">
                </div>
            </div>
        </div>
        <script>
            $(document).ready(function() {
                $("#results-panel").hide();
                $("#error-panel").hide();

                $("#submit").on("click", function(e) {
                    e.preventDefault();

                    var start = $("#start-link").val();
                    var end = $("#end-link").val();

                    $("#results-panel").hide();
                    $("#error-panel").hide();

                    $.ajax({
                        url: "/api/lookup",
                        data: {
                            "start": start,
                            "end": end
                        },
                        success: function(json) {
                            console.log(json);
                            result = JSON.parse(json);
                            if (result.error) {
                                $("#error-panel").show();
                                $("#error-panel .panel-body").html(result.error);
                            }
                            else {
                                $("#results-panel").show();
                                $("#results-panel .panel-body").html(formatResult(result));
                            }
                        },
                        error: function(e) {
                            console.log(e);
                            $("#error-panel").show();
                            $("#error-panel .panel-body").html("Unable to connect to server...");
                        }
                    })

                });
            });

            // lol
            var STEPS = [
                "zero",
                "one",
                "two",
                "three",
                "four",
                "five",
                "six",
                "seven",
                "eight",
                "nine",
                "ten"
            ];

            function formatResult(result) {
                var message = "It takes " + STEPS[result.length - 1]
                message += " step" + (result.length != 2 ? "s" : "") + ": ";
                message += formatLink(result[0]) + " links to " + formatLink(result[1]);

                for (var i = 2; i < result.length; i++) {
                    message += " which links to " + formatLink(result[i]);
                }

                return message;
            }

            function formatLink(link) {
                var text = decodeURIComponent(link).replace(new RegExp("_", 'g'), " ");
                return "<a href=\"https://en.wikipedia.org/wiki/" + link + "\">" + text + "</" + "a>";
            }
        </script>
    </body>
</html>
